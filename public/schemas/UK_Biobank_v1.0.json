{
  "name": "UK Biobank",
  "description": "Brain imaging protocol for the UK Biobank prospective epidemiological study (~100,000 participants). Acquired on Siemens Skyra 3T scanners at dedicated imaging centers across the UK. Protocol version 4.0.\n\nReference: Miller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
  "version": "1.0",
  "authors": [
    "Ashley Stewart"
  ],
  "acquisitions": {
    "T1-weighted 3D MPRAGE": {
      "description": "3D T1-weighted MPRAGE acquisition for high-resolution brain anatomy",
      "detailed_description": "## T1-Weighted Structural MRI\n\nThis acquisition provides high-resolution T1-weighted anatomical images of the brain using a 3D Magnetization-Prepared Rapid Gradient Echo (MPRAGE) sequence.\n\n### Purpose\n\nThe T1-weighted structural scan serves as the primary anatomical reference for UK Biobank brain imaging and is used for:\n- Brain tissue segmentation (grey matter, white matter, CSF)\n- Cortical surface reconstruction and thickness measurements\n- Subcortical structure volumetrics\n- Spatial normalization and registration template\n- Identification of gross anatomical abnormalities\n\n### Acquisition Parameters\n\n- **Sequence**: 3D MPRAGE (tfl3d1_16ns)\n- **Resolution**: 1.0 mm isotropic\n- **FOV**: 256 x 256 mm, sagittal orientation\n- **TR/TE/TI**: 2000 ms / 2.01 ms / 880 ms\n- **Flip Angle**: 8 degrees\n- **Acceleration**: GRAPPA factor 2\n- **Scan Time**: ~5 minutes\n\n### Key Features\n\n- Isotropic resolution enables high-quality reformatting in any plane\n- Inversion recovery preparation provides excellent grey/white matter contrast\n- Whole-brain coverage from vertex to below cerebellum\n- Consistent positioning using AutoAlign to AC-PC orientation\n\n### Derived Measures\n\nUK Biobank provides numerous imaging-derived phenotypes (IDPs) from this scan including:\n- Total brain volume, grey matter volume, white matter volume\n- Regional volumes (hippocampus, amygdala, thalamus, etc.)\n- Cortical thickness and surface area measures\n- Subcortical structure volumes\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["analysis:segmentation", "analysis:volumetry", "analysis:cortical-thickness", "brain", "structural", "T1-weighted"],
      "fields": [
        {
          "field": "SeriesDescription",
          "tag": "0008,103E",
          "value": "T1_p2_1mm_fov256_sag_TI_880"
        },
        {
          "field": "SequenceName",
          "tag": "0018,0024",
          "value": "*tfl3d1_16ns"
        },
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SK",
            "SP",
            "MP",
            "OSP"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": [
            "GR",
            "IR"
          ]
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "3D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 1
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            1,
            1
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 256
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 256
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            0,
            256,
            256,
            0
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 2000
        },
        {
          "field": "EchoTime",
          "tag": "0018,0081",
          "value": 2.01
        },
        {
          "field": "InversionTime",
          "tag": "0018,0082",
          "value": 880
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 8
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 1
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 240,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "ROW"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 269
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.26391,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 100
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": "IR"
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        }
      ],
      "series": [
        {
          "name": "Series_001",
          "fields": [
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND",
                "NORM"
              ]
            }
          ]
        },
        {
          "name": "Series_002",
          "fields": [
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND"
              ]
            }
          ]
        }
      ],
      "rules": []
    },
    "Functional brain images - task": {
      "description": "Multi-band EPI acquisition for task-based functional MRI",
      "detailed_description": "## Task-Based Functional MRI\n\nThis acquisition captures brain activity during a cognitive task using Blood Oxygen Level Dependent (BOLD) contrast with multi-band acceleration.\n\n### Purpose\n\nThe task fMRI scan measures brain activation patterns during the Hariri faces/shapes emotional processing task:\n- Identify brain regions involved in emotional face processing\n- Assess amygdala reactivity to emotional stimuli\n- Study individual differences in emotional processing circuitry\n- Enable genome-wide association studies of brain function\n\n### Task Paradigm\n\nThe Hariri faces/shapes task alternates between:\n- **Faces blocks**: Match emotional expressions (angry, fearful, neutral)\n- **Shapes blocks**: Match geometric shapes (control condition)\n- Total duration: ~4 minutes (332 volumes)\n\n### Acquisition Parameters\n\n- **Sequence**: Gradient-echo EPI with multi-band acceleration\n- **Resolution**: 2.4 mm isotropic\n- **FOV**: 210 x 210 mm, transverse oblique (AC-PC aligned)\n- **TR/TE**: 735 ms / 39 ms\n- **Flip Angle**: 52 degrees\n- **Multi-band Factor**: 8 (64 slices acquired simultaneously in 8 groups)\n- **Volumes**: 332\n- **Scan Time**: ~4 minutes\n\n### Key Features\n\n- Ultra-fast TR (735 ms) enabled by multi-band acceleration\n- Whole-brain coverage with no slice gaps\n- Fat saturation to reduce signal from subcutaneous fat\n- Single-band reference (SBRef) image acquired for motion correction\n\n### Processing Considerations\n\n- Susceptibility-induced distortions corrected using field maps\n- Motion correction and slice-timing correction applied\n- Spatial smoothing and temporal filtering\n- GLM analysis for task activation maps\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["analysis:fmri", "brain", "fMRI", "task-based"],
      "fields": [
        {
          "field": "SequenceName",
          "tag": "0018,0024",
          "value": "epfid2d1_88"
        },
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SK",
            "SS"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": "EP"
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "2D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 2.4
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            2.38636,
            2.38636
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 704
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 704
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            88,
            0,
            0,
            88
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 735
        },
        {
          "field": "EchoTime",
          "tag": "0018,0081",
          "value": 39,
          "tolerance": 4
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 52,
          "tolerance": 2
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 88
        },
        {
          "field": "MultibandFactor",
          "tag": "derived",
          "value": 8
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 2030,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "COL"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 88
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.26392,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 100
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": "FS"
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        }
      ],
      "series": [
        {
          "name": "Series_002",
          "fields": [
            {
              "field": "SeriesDescription",
              "tag": "0008,103E",
              "value": "MB8_FMRI_fov210_2.4mm_task"
            },
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "MB",
                "ND",
                "MOSAIC"
              ]
            }
          ]
        },
        {
          "name": "Series_001",
          "fields": [
            {
              "field": "SeriesDescription",
              "tag": "0008,103E",
              "value": "MB8_FMRI_fov210_2.4mm_task_SBRef"
            },
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND",
                "MOSAIC"
              ]
            }
          ]
        }
      ],
      "rules": []
    },
    "Multiband diffusion brain images": {
      "description": "Multi-shell diffusion MRI with multi-band acceleration for white matter microstructure",
      "detailed_description": "## Diffusion-Weighted MRI\n\nThis acquisition provides multi-shell diffusion-weighted imaging for characterizing white matter microstructure using multi-band acceleration.\n\n### Purpose\n\nThe diffusion MRI scan enables investigation of white matter organization and connectivity:\n- White matter tract reconstruction (tractography)\n- Microstructural measures (FA, MD, diffusivities)\n- Advanced modeling (NODDI, DKI)\n- Structural connectivity analysis\n- Detection of white matter pathology\n\n### Acquisition Parameters\n\n- **Sequence**: Spin-echo EPI with multi-band acceleration\n- **Resolution**: 2.0 mm isotropic\n- **FOV**: 210 x 210 mm, transverse oblique (AC-PC aligned)\n- **TR/TE**: 3600 ms / 92 ms\n- **Flip Angle**: 78 degrees\n- **Multi-band Factor**: 3 (72 slices acquired in 24 groups)\n- **Slices**: 72 (whole brain coverage)\n\n### Diffusion Scheme\n\n- **b = 0 s/mm²**: ~8 volumes (non-diffusion weighted)\n- **b = 1000 s/mm²**: 50 directions\n- **b = 2000 s/mm²**: 50 directions\n- **Total volumes**: 108\n- **Scan Time**: ~7 minutes (including PA field map)\n\n### Field Map Acquisition\n\nA short reverse phase-encode (PA) acquisition with 3 b=0 volumes is acquired for susceptibility distortion correction using FSL's topup.\n\n### Key Features\n\n- Multi-shell design enables advanced diffusion models beyond DTI\n- Multi-band acceleration reduces scan time while maintaining angular resolution\n- Isotropic resolution for accurate tractography\n- Optimized gradient directions for uniform sampling\n\n### Derived Measures\n\nUK Biobank provides diffusion IDPs including:\n- Fractional anisotropy (FA) in major white matter tracts\n- Mean diffusivity (MD), axial and radial diffusivity\n- NODDI metrics (ICVF, ISOVF, OD)\n- Tract-averaged measures for 27 major pathways\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["analysis:diffusion", "brain", "dMRI", "multiband"],
      "fields": [
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SK",
            "SS"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": "EP"
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "2D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 2
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            2.01923,
            2.01923
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 936
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 936
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            104,
            0,
            0,
            104
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 3600
        },
        {
          "field": "EchoTime",
          "tag": "0018,0081",
          "value": 92
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 78
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 78
        },
        {
          "field": "MultibandFactor",
          "tag": "derived",
          "value": 3
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 1780,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "COL"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 78
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.2639,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 100
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": [
            "PFP",
            "FS"
          ]
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        },
        {
          "field": "ImageType",
          "tag": "0008,0008",
          "value": [
            "ORIGINAL",
            "PRIMARY",
            "DIFFUSION",
            "NONE",
            "MB",
            "ND",
            "MOSAIC"
          ]
        }
      ],
      "series": [],
      "rules": [
        {
          "id": "custom_1758075459044",
          "name": "Diffusion Directions",
          "description": "Checks expected number of diffusion gradient directions",
          "implementation": "n_expected = 100\ndirections = [\n  tuple(d) if isinstance(d, list) else \n  d for d in value[\"DiffusionGradientOrientation\"]\n]\nn_actual = len(set(directions))\n\nif n_actual != n_expected:\n  raise ValidationError(f\"Expected {n_expected} distinct diffusion gradient directions, but found {n_actual}.\")\n",
          "fields": [
            "DiffusionGradientOrientation"
          ],
          "testCases": [
            {
              "id": "test_1759471463995",
              "name": "Expected number of gradients",
              "data": {
                "DiffusionGradientOrientation": [
                  [
                    0,
                    0
                  ],
                  [
                    0,
                    1
                  ],
                  [
                    0,
                    2
                  ],
                  [
                    0,
                    3
                  ],
                  [
                    0,
                    4
                  ],
                  [
                    0,
                    5
                  ],
                  [
                    0,
                    6
                  ],
                  [
                    0,
                    7
                  ],
                  [
                    0,
                    8
                  ],
                  [
                    0,
                    9
                  ],
                  [
                    1,
                    0
                  ],
                  [
                    1,
                    1
                  ],
                  [
                    1,
                    2
                  ],
                  [
                    1,
                    3
                  ],
                  [
                    1,
                    4
                  ],
                  [
                    1,
                    5
                  ],
                  [
                    1,
                    6
                  ],
                  [
                    1,
                    7
                  ],
                  [
                    1,
                    8
                  ],
                  [
                    1,
                    9
                  ],
                  [
                    2,
                    0
                  ],
                  [
                    2,
                    1
                  ],
                  [
                    2,
                    2
                  ],
                  [
                    2,
                    3
                  ],
                  [
                    2,
                    4
                  ],
                  [
                    2,
                    5
                  ],
                  [
                    2,
                    6
                  ],
                  [
                    2,
                    7
                  ],
                  [
                    2,
                    8
                  ],
                  [
                    2,
                    9
                  ],
                  [
                    3,
                    0
                  ],
                  [
                    3,
                    1
                  ],
                  [
                    3,
                    2
                  ],
                  [
                    3,
                    3
                  ],
                  [
                    3,
                    4
                  ],
                  [
                    3,
                    5
                  ],
                  [
                    3,
                    6
                  ],
                  [
                    3,
                    7
                  ],
                  [
                    3,
                    8
                  ],
                  [
                    3,
                    9
                  ],
                  [
                    4,
                    0
                  ],
                  [
                    4,
                    1
                  ],
                  [
                    4,
                    2
                  ],
                  [
                    4,
                    3
                  ],
                  [
                    4,
                    4
                  ],
                  [
                    4,
                    5
                  ],
                  [
                    4,
                    6
                  ],
                  [
                    4,
                    7
                  ],
                  [
                    4,
                    8
                  ],
                  [
                    4,
                    9
                  ],
                  [
                    5,
                    0
                  ],
                  [
                    5,
                    1
                  ],
                  [
                    5,
                    2
                  ],
                  [
                    5,
                    3
                  ],
                  [
                    5,
                    4
                  ],
                  [
                    5,
                    5
                  ],
                  [
                    5,
                    6
                  ],
                  [
                    5,
                    7
                  ],
                  [
                    5,
                    8
                  ],
                  [
                    5,
                    9
                  ],
                  [
                    6,
                    0
                  ],
                  [
                    6,
                    1
                  ],
                  [
                    6,
                    2
                  ],
                  [
                    6,
                    3
                  ],
                  [
                    6,
                    4
                  ],
                  [
                    6,
                    5
                  ],
                  [
                    6,
                    6
                  ],
                  [
                    6,
                    7
                  ],
                  [
                    6,
                    8
                  ],
                  [
                    6,
                    9
                  ],
                  [
                    7,
                    0
                  ],
                  [
                    7,
                    1
                  ],
                  [
                    7,
                    2
                  ],
                  [
                    7,
                    3
                  ],
                  [
                    7,
                    4
                  ],
                  [
                    7,
                    5
                  ],
                  [
                    7,
                    6
                  ],
                  [
                    7,
                    7
                  ],
                  [
                    7,
                    8
                  ],
                  [
                    7,
                    9
                  ],
                  [
                    8,
                    0
                  ],
                  [
                    8,
                    1
                  ],
                  [
                    8,
                    2
                  ],
                  [
                    8,
                    3
                  ],
                  [
                    8,
                    4
                  ],
                  [
                    8,
                    5
                  ],
                  [
                    8,
                    6
                  ],
                  [
                    8,
                    7
                  ],
                  [
                    8,
                    8
                  ],
                  [
                    8,
                    9
                  ],
                  [
                    9,
                    0
                  ],
                  [
                    9,
                    1
                  ],
                  [
                    9,
                    2
                  ],
                  [
                    9,
                    3
                  ],
                  [
                    9,
                    4
                  ],
                  [
                    9,
                    5
                  ],
                  [
                    9,
                    6
                  ],
                  [
                    9,
                    7
                  ],
                  [
                    9,
                    8
                  ],
                  [
                    9,
                    9
                  ]
                ]
              },
              "expectedResult": "pass",
              "description": ""
            },
            {
              "id": "test_1759471812791",
              "name": "New Test Case",
              "data": {
                "DiffusionGradientOrientation": [
                  [
                    0,
                    0
                  ],
                  [
                    0,
                    1
                  ],
                  [
                    0,
                    2
                  ],
                  [
                    0,
                    3
                  ],
                  [
                    0,
                    4
                  ],
                  [
                    1,
                    0
                  ],
                  [
                    1,
                    1
                  ],
                  [
                    1,
                    2
                  ],
                  [
                    1,
                    3
                  ],
                  [
                    1,
                    4
                  ],
                  [
                    2,
                    0
                  ],
                  [
                    2,
                    1
                  ],
                  [
                    2,
                    2
                  ],
                  [
                    2,
                    3
                  ],
                  [
                    2,
                    4
                  ],
                  [
                    3,
                    0
                  ],
                  [
                    3,
                    1
                  ],
                  [
                    3,
                    2
                  ],
                  [
                    3,
                    3
                  ],
                  [
                    3,
                    4
                  ],
                  [
                    4,
                    0
                  ],
                  [
                    4,
                    1
                  ],
                  [
                    4,
                    2
                  ],
                  [
                    4,
                    3
                  ],
                  [
                    4,
                    4
                  ]
                ]
              },
              "expectedResult": "fail",
              "description": ""
            }
          ]
        },
        {
          "id": "custom_1758079469072",
          "name": "B-value Distribution Validation",
          "description": "Validate b-value shell distribution",
          "implementation": "b_values = value[\"DiffusionBValue\"]\nb0_count = sum(1 for b in b_values if b < 50)  # b≈0 images\nb1000_count = sum(1 for b in b_values if 900 <= b <= 1100)  # b≈1000 shell\nb2000_count = sum(1 for b in b_values if 1900 <= b <= 2100)  # b≈2000 shell\n\nif b0_count < 8 or b0_count > 12:\n  raise ValueError(f\"Expected ~10 b=0 images, found {b0_count}\")\n\nif b1000_count < 45 or b1000_count > 55:\n  raise ValueError(f\"Expected ~50 b=1000 images, found {b1000_count}\")\n\nif b2000_count < 45 or b2000_count > 55:\n  raise ValueError(f\"Expected ~50 b=2000 images, found {b2000_count}\")",
          "fields": [
            "DiffusionBValue"
          ],
          "testCases": [
            {
              "id": "test_1759471849726",
              "name": "Pass",
              "data": {
                "DiffusionBValue": [
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  1000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000,
                  2000
                ]
              },
              "expectedResult": "pass",
              "description": ""
            }
          ]
        }
      ]
    },
    "Susceptibility weighted brain images": {
      "description": "3D dual-echo gradient echo acquisition for susceptibility-weighted imaging",
      "detailed_description": "## Susceptibility-Weighted Imaging (SWI)\n\nThis acquisition provides high-resolution susceptibility-weighted images using a 3D dual-echo gradient echo sequence, sensitive to iron, blood products, and venous structures.\n\n### Purpose\n\nThe SWI scan enables detection of susceptibility-related tissue properties:\n- Cerebral microbleed detection and quantification\n- Iron deposition in deep grey matter structures\n- Venous architecture visualization\n- Calcification detection\n- Assessment of small vessel disease\n\n### Acquisition Parameters\n\n- **Sequence**: 3D flow-compensated dual-echo GRE (fl3d2r)\n- **Resolution**: 0.8 x 0.8 x 3.0 mm (high in-plane, thick slices)\n- **FOV**: 230 x 205 mm, transverse oblique (AC-PC aligned)\n- **TR**: 27 ms\n- **TE1/TE2**: 9.4 ms / 19.7 ms\n- **Flip Angle**: 15 degrees\n- **Acceleration**: GRAPPA factor 2\n- **Slices**: 48\n- **Scan Time**: ~2.5 minutes\n\n### Dual-Echo Design\n\nTwo echoes are acquired per TR:\n- **First echo (TE=9.4 ms)**: Less T2* weighting, better SNR\n- **Second echo (TE=19.7 ms)**: More susceptibility contrast\n\nBoth magnitude and phase images are saved for each echo.\n\n### Key Features\n\n- Flow compensation reduces vessel signal loss from flowing blood\n- Phase images enable QSM-like processing\n- High in-plane resolution for microbleed detection\n- Bipolar readout for efficient dual-echo acquisition\n\n### Derived Measures\n\nUK Biobank uses SWI for:\n- Automated microbleed detection and counting\n- T2* mapping from dual-echo data\n- Iron quantification in basal ganglia\n- Small vessel disease burden assessment\n\n### Clinical Relevance\n\nMicrobleeds detected on SWI are associated with:\n- Cerebral amyloid angiopathy\n- Hypertensive vasculopathy\n- Increased stroke risk\n- Cognitive decline\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["analysis:qsm", "analysis:swi", "analysis:relaxometry", "brain", "SWI", "susceptibility", "T2*-weighted", "QSM"],
      "fields": [
        {
          "field": "SeriesDescription",
          "tag": "0008,103E",
          "value": "SWI_3mm_Updated_v1.1"
        },
        {
          "field": "SequenceName",
          "tag": "0018,0024",
          "value": "*fl3d2r"
        },
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SP",
            "OSP"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": "GR"
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "3D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 3
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            0.79861,
            0.79861
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 288
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 256
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            0,
            288,
            256,
            0
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 27
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 15
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 2
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 140,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "ROW"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 223
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.26392,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 88.88889
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": "PFP"
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        }
      ],
      "series": [
        {
          "name": "TE1",
          "fields": [
            {
              "field": "EchoTime",
              "tag": "0018,0081",
              "value": 9.42
            }
          ]
        },
        {
          "name": "TE2",
          "fields": [
            {
              "field": "EchoTime",
              "tag": "0018,0081",
              "value": 19.7
            }
          ]
        }
      ],
      "rules": [
        {
          "id": "custom_1758084379924",
          "name": "Expected number of echoes",
          "description": "Expected two echoes",
          "implementation": "expected = 2\nactual = value['EchoTime'].nunique()\n\nif expected != actual:\n  raise ValidationError(f\"Expected {expected} echoes but got {actual}.\")",
          "fields": [
            "EchoTime"
          ],
          "testCases": [
            {
              "id": "test_1759471943584",
              "name": "Two echoes",
              "data": {
                "EchoTime": [
                  2,
                  4
                ]
              },
              "expectedResult": "pass",
              "description": ""
            }
          ]
        },
        {
          "id": "validate_image_type",
          "name": "Valid Magnitude/Phase Pairs",
          "description": "Each EchoTime must have at least one magnitude and phase image.",
          "implementation": "magnitude_counts = []\nphase_counts = []\n\nfor echo_time, group in value.groupby(\"EchoTime\"):\n    image_types = group[\"ImageType\"]\n    \n    # Count occurrences of 'M' and 'P' in ImageType tuples\n    magnitude_counts.append(sum('M' in image for image in image_types))\n    phase_counts.append(sum('P' in image for image in image_types))\n\nif not all(m >= 1 for m in magnitude_counts):\n    raise ValidationError(f\"Each EchoTime must have at least one magnitude image. Found {magnitude_counts}.\")\nif not all(p >= 1 for p in phase_counts):\n    raise ValidationError(f\"Each EchoTime must have at least one phase image. Found {phase_counts}.\")\n",
          "fields": [
            "ImageType",
            "EchoTime"
          ],
          "testCases": [
            {
              "id": "test_1759471956768",
              "name": "Pass",
              "data": {
                "ImageType": [
                  "M",
                  "P",
                  "M",
                  "P"
                ],
                "EchoTime": [
                  2,
                  2,
                  4,
                  4
                ]
              },
              "expectedResult": "pass",
              "description": ""
            }
          ]
        }
      ]
    },
    "T2 FLAIR structural brain images": {
      "description": "3D T2-weighted FLAIR acquisition for white matter lesion detection",
      "detailed_description": "## T2-Weighted FLAIR Structural MRI\n\nThis acquisition provides T2-weighted images with CSF suppression using a 3D Fluid-Attenuated Inversion Recovery (FLAIR) sequence, optimized for detecting white matter abnormalities.\n\n### Purpose\n\nThe T2 FLAIR scan is primarily used for:\n- White matter hyperintensity (WMH) detection and quantification\n- Assessment of small vessel cerebrovascular disease\n- Detection of periventricular and deep white matter lesions\n- Multiple sclerosis lesion identification\n- Stroke and ischemic lesion detection\n\n### Acquisition Parameters\n\n- **Sequence**: 3D SPACE with FLAIR (spcir_284ns)\n- **Resolution**: 1.0 x 1.0 x 1.05 mm (near-isotropic)\n- **FOV**: 256 x 256 mm, sagittal orientation\n- **TR/TE/TI**: 5000 ms / 395 ms / 1800 ms\n- **Flip Angle**: Variable (T2-optimized)\n- **Turbo Factor**: 284\n- **Acceleration**: GRAPPA factor 2\n- **Slices**: 192\n- **Scan Time**: ~6 minutes\n\n### Key Features\n\n- Long inversion time (TI=1800 ms) suppresses CSF signal\n- CSF suppression makes periventricular lesions clearly visible\n- 3D acquisition enables reformatting in any plane\n- Fat saturation reduces scalp signal artifacts\n- Near-isotropic resolution for accurate volumetric measurements\n\n### FLAIR Physics\n\nThe FLAIR technique uses an inversion pulse timed so that CSF (with long T1) has zero longitudinal magnetization at the time of excitation. This nulls CSF signal while preserving signal from pathological tissue that would otherwise be obscured.\n\n### Derived Measures\n\nUK Biobank provides WMH-related IDPs:\n- Total white matter hyperintensity volume\n- Periventricular vs deep WMH volumes\n- Lesion count and distribution\n- Fazekas visual rating scale scores\n\n### Clinical Relevance\n\nWhite matter hyperintensities on FLAIR are associated with:\n- Age and vascular risk factors\n- Cognitive decline and dementia risk\n- Stroke risk\n- Gait and balance disturbances\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["brain", "structural", "FLAIR"],
      "fields": [
        {
          "field": "SeriesDescription",
          "tag": "0008,103E",
          "value": "T2_flair_sag_p2_1mm_FS_ellip_pf78"
        },
        {
          "field": "SequenceName",
          "tag": "0018,0024",
          "value": "*spcir_284ns"
        },
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SK",
            "SP",
            "MP"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": [
            "SE",
            "IR"
          ]
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "3D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 1.05
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            1,
            1
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 256
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 256
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            0,
            256,
            256,
            0
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 5000
        },
        {
          "field": "EchoTime",
          "tag": "0018,0081",
          "value": 395
        },
        {
          "field": "InversionTime",
          "tag": "0018,0082",
          "value": 1800
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 120
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 254
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 780,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "ROW"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 209
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.26392,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 100
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": [
            "IR",
            "PFP",
            "FS"
          ]
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        }
      ],
      "series": [
        {
          "name": "Series_001",
          "fields": [
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND"
              ]
            }
          ]
        },
        {
          "name": "Series_002",
          "fields": [
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND",
                "NORM"
              ]
            }
          ]
        }
      ],
      "rules": []
    },
    "Functional brain images - resting": {
      "description": "Multi-band EPI acquisition for resting-state functional connectivity",
      "detailed_description": "## Resting-State Functional MRI\n\nThis acquisition captures spontaneous brain activity fluctuations during rest using BOLD contrast with multi-band acceleration, enabling analysis of intrinsic functional connectivity.\n\n### Purpose\n\nThe resting-state fMRI scan enables investigation of intrinsic brain organization:\n- Functional connectivity between brain regions\n- Identification of resting-state networks (default mode, salience, etc.)\n- Network topology and graph-theoretic measures\n- Individual differences in brain functional organization\n- Biomarkers for neurological and psychiatric conditions\n\n### Acquisition Parameters\n\n- **Sequence**: Gradient-echo EPI with multi-band acceleration\n- **Resolution**: 2.4 mm isotropic\n- **FOV**: 210 x 210 mm, transverse oblique (AC-PC aligned)\n- **TR/TE**: 735 ms / 39 ms\n- **Flip Angle**: 52 degrees\n- **Multi-band Factor**: 8 (64 slices acquired simultaneously in 8 groups)\n- **Slices**: 64 (whole brain coverage)\n- **Volumes**: 490\n- **Scan Time**: ~6 minutes\n\n### Participant Instructions\n\nDuring the resting-state scan, participants are instructed to:\n- Keep eyes open and fixate on a crosshair\n- Stay awake and relaxed\n- Let their mind wander freely\n- Avoid structured thinking or mental tasks\n\n### Key Features\n\n- Ultra-fast TR (735 ms) provides excellent temporal resolution\n- Multi-band acceleration enables whole-brain coverage with short TR\n- ~6 minutes provides sufficient data for reliable connectivity estimates\n- Single-band reference (SBRef) image for distortion correction\n- Fat saturation reduces artifacts from subcutaneous tissue\n\n### Derived Measures\n\nUK Biobank provides numerous functional connectivity IDPs:\n- Node amplitudes for 21 resting-state network nodes (ICA-based)\n- Full and partial correlation matrices between network nodes\n- Network-specific connectivity measures\n- Amplitude of low-frequency fluctuations (ALFF)\n\n### Processing Pipeline\n\n1. Motion correction and distortion correction (using field maps)\n2. Registration to T1 and MNI space\n3. ICA-based denoising (FIX) to remove artifacts\n4. Bandpass filtering (typically 0.01-0.1 Hz)\n5. Dual regression for subject-specific network maps\n\n### Reference\n\nMiller, K.L., et al. (2016). Multimodal population brain imaging in the UK Biobank prospective epidemiological study. Nature Neuroscience, 19(11), 1523-1536.",
      "tags": ["analysis:fmri", "brain", "fMRI", "resting-state"],
      "fields": [
        {
          "field": "SequenceName",
          "tag": "0018,0024",
          "value": "epfid2d1_88"
        },
        {
          "field": "SequenceVariant",
          "tag": "0018,0021",
          "value": [
            "SK",
            "SS"
          ]
        },
        {
          "field": "ScanningSequence",
          "tag": "0018,0020",
          "value": "EP"
        },
        {
          "field": "Manufacturer",
          "tag": "0008,0070",
          "value": "SIEMENS"
        },
        {
          "field": "ManufacturerModelName",
          "tag": "0008,1090",
          "value": "Skyra"
        },
        {
          "field": "MRAcquisitionType",
          "tag": "0018,0023",
          "value": "2D"
        },
        {
          "field": "SliceThickness",
          "tag": "0018,0050",
          "value": 2.4
        },
        {
          "field": "PixelSpacing",
          "tag": "0028,0030",
          "value": [
            2.38636,
            2.38636
          ]
        },
        {
          "field": "Rows",
          "tag": "0028,0010",
          "value": 704
        },
        {
          "field": "Columns",
          "tag": "0028,0011",
          "value": 704
        },
        {
          "field": "AcquisitionMatrix",
          "tag": "0018,1310",
          "value": [
            88,
            0,
            0,
            88
          ]
        },
        {
          "field": "RepetitionTime",
          "tag": "0018,0080",
          "value": 735
        },
        {
          "field": "EchoTime",
          "tag": "0018,0081",
          "value": 39,
          "tolerance": 4
        },
        {
          "field": "FlipAngle",
          "tag": "0018,1314",
          "value": 52,
          "tolerance": 2
        },
        {
          "field": "EchoTrainLength",
          "tag": "0018,0091",
          "value": 88
        },
        {
          "field": "MultibandFactor",
          "tag": "derived",
          "value": 8
        },
        {
          "field": "PixelBandwidth",
          "tag": "0018,0095",
          "value": 2030,
          "tolerance": 1
        },
        {
          "field": "InPlanePhaseEncodingDirection",
          "tag": "0018,1312",
          "value": "COL"
        },
        {
          "field": "NumberOfPhaseEncodingSteps",
          "tag": "0018,0089",
          "value": 88
        },
        {
          "field": "MagneticFieldStrength",
          "tag": "0018,0087",
          "value": 3,
          "tolerance": 0.3
        },
        {
          "field": "ImagingFrequency",
          "tag": "0018,0084",
          "value": 123.26389,
          "tolerance": 1
        },
        {
          "field": "ImagedNucleus",
          "tag": "0018,0085",
          "value": "1H"
        },
        {
          "field": "TransmitCoilName",
          "tag": "0018,1251",
          "value": "Body"
        },
        {
          "field": "PercentSampling",
          "tag": "0018,0093",
          "value": 100
        },
        {
          "field": "PercentPhaseFieldOfView",
          "tag": "0018,0094",
          "value": 100
        },
        {
          "field": "ScanOptions",
          "tag": "0018,0022",
          "value": "FS"
        },
        {
          "field": "AngioFlag",
          "tag": "0018,0025",
          "value": "N"
        }
      ],
      "series": [
        {
          "name": "Series_002",
          "fields": [
            {
              "field": "SeriesDescription",
              "tag": "0008,103E",
              "value": "MB8_FMRI_fov210_2.4mm_resting"
            },
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "MB",
                "ND",
                "MOSAIC"
              ]
            }
          ]
        },
        {
          "name": "Series_001",
          "fields": [
            {
              "field": "SeriesDescription",
              "tag": "0008,103E",
              "value": "MB8_FMRI_fov210_2.4mm_resting_SBRef"
            },
            {
              "field": "ImageType",
              "tag": "0008,0008",
              "value": [
                "ORIGINAL",
                "PRIMARY",
                "M",
                "ND",
                "MOSAIC"
              ]
            }
          ]
        }
      ],
      "rules": []
    }
  }
}